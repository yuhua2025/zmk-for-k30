name: Build K30 Keyboard - Full Firmware

on: [push, pull_request, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: zmkfirmware/zmk-build-arm:stable
      options: --user root

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Initialize ZMK and force latest main
        run: |
          west init -l config
          west update
          # ğŸ‘‡ å…³é”®ï¼šå¼ºåˆ¶æ›´æ–° zmk/app åˆ°å®˜æ–¹æœ€æ–° main åˆ†æ”¯
          cd zmk/app
          git remote set-url origin https://github.com/zmkfirmware/zmk.git
          git fetch origin
          git checkout main
          git pull origin main
          west update  # ç¡®ä¿å­æ¨¡å—ä¹Ÿæ›´æ–°

      - name: Build firmware
        run: |
          west build -b nrfmicro_13 -s zmk/app -- \
            -DZMK_CONFIG="$GITHUB_WORKSPACE/config" \
            -DSHIELD=k30

      - name: Upload firmware
        uses: actions/upload-artifact@v4
        with:
          name: k30-full-firmware
          path: build/zephyr/zmk.uf2
