name: Build K30 Keyboard - Full Firmware

on: [push, pull_request, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: zmkfirmware/zmk-build-arm:stable
      options: --user root

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Initialize ZMK and force latest main
        run: |
          west init -l config
          west update
          # ğŸ‘‡ ä¿®å¤ï¼šå…ˆ add originï¼Œå† fetch
          cd zmk/app
          git remote add origin https://github.com/zmkfirmware/zmk.git || true
          git fetch origin
          git checkout main
          git pull origin main
          west update  # æ›´æ–°å­æ¨¡å—ï¼ˆå¦‚ neededï¼‰

      - name: Build firmware
        run: |
          west build -b nrfmicro_13 -s zmk/app -- \
            -DZMK_CONFIG="$GITHUB_WORKSPACE/config" \
            -DSHIELD=k30

      - name: Upload firmware
        uses: actions/upload-artifact@v4
        with:
          name: k30-full-firmware
          path: build/zephyr/zmk.uf2
